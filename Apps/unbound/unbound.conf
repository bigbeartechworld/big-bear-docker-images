server:
    # ====================
    # Network Configuration
    # ====================
    
    # Disable chroot (Docker provides isolation)
    chroot: ""
    
    # The interface that Unbound will bind to (listen on all interfaces)
    interface: 0.0.0.0@53
    # interface: ::0@53  # Uncomment for IPv6 support
    
    # Enable IPv4, disable IPv6 (enable if your network supports it)
    do-ip4: yes
    do-ip6: no
    
    # Enable UDP and TCP
    do-udp: yes
    do-tcp: yes
    
    # Access control - restrict to private networks by default
    # IMPORTANT: Restrict to your specific networks in production to prevent DNS amplification attacks
    access-control: 127.0.0.0/8 allow
    access-control: 10.0.0.0/8 allow
    access-control: 172.16.0.0/12 allow
    access-control: 192.168.0.0/16 allow
    # Uncomment below only if you understand the security implications
    # access-control: 0.0.0.0/0 allow
    
    # ====================
    # DNSSEC Configuration
    # ====================
    
    # Use the root servers key for DNSSEC validation
    auto-trust-anchor-file: "/var/lib/unbound/root.key"
    
    # Use the public root servers as the authoritative servers
    root-hints: "/var/lib/unbound/root.hints"
    
    # ====================
    # Privacy & Security
    # ====================
    
    # Send minimum amount of information to upstream servers (RFC 7816)
    qname-minimisation: yes
    
    # Hide identity and version
    hide-identity: yes
    hide-version: yes
    
    # Harden the DNS server against various attacks
    harden-glue: yes
    harden-dnssec-stripped: yes
    harden-referral-path: yes
    harden-below-nxdomain: yes
    harden-algo-downgrade: yes
    
    # Harden against unverified out-of-zone glue (Unbound 1.22+)
    harden-unverified-glue: yes
    
    # Use NSEC/NSEC3 aggressively to reduce queries (RFC 8198)
    aggressive-nsec: yes
    
    # Ensure privacy of local IP ranges (RFC 1918)
    private-address: 10.0.0.0/8
    private-address: 172.16.0.0/12
    private-address: 192.168.0.0/16
    private-address: 169.254.0.0/16
    private-address: fd00::/8
    private-address: fe80::/10
    
    # ====================
    # DoS Protection (DNSBomb mitigations - Unbound 1.20+)
    # ====================
    
    # Drop replies that have been waiting too long (milliseconds)
    discard-timeout: 1900
    
    # Limit outstanding queries per IP to prevent amplification attacks
    wait-limit: 1000
    wait-limit-cookie: 10000
    
    # ====================
    # Performance Tuning
    # ====================
    
    # Number of threads to create (1 per CPU core recommended)
    num-threads: 1
    
    # Number of queries per thread
    num-queries-per-thread: 2048
    
    # Perform prefetching of close to expired message cache entries
    prefetch: yes
    prefetch-key: yes
    
    # Serve expired cache entries while refreshing in background
    serve-expired: yes
    serve-expired-ttl: 86400
    serve-expired-client-timeout: 1800
    
    # Minimum lifetime of cache entries in seconds
    cache-min-ttl: 300
    
    # Maximum lifetime of cached entries (24 hours)
    cache-max-ttl: 86400
    
    # Maximum negative cache TTL (1 hour)
    cache-max-negative-ttl: 3600
    
    # Ensure kernel buffer is large enough to not lose messages in traffic spikes
    so-rcvbuf: 1m
    so-sndbuf: 4m
    
    # More outgoing connections (for high query loads)
    outgoing-range: 8192
    
    # ====================
    # Logging Configuration
    # ====================
    
    # Do not daemonize (required for Docker)
    do-daemonize: no
    
    # Use stderr for logging (Docker-friendly)
    use-syslog: no
    logfile: ""
    
    # Verbosity level (0=errors only, 1=operational, 2=detailed, 3+=debug)
    verbosity: 1
    
    # Log queries (set to yes for debugging, no for production)
    log-queries: no
    log-replies: no
    log-servfail: yes
    
    # ====================
    # Resource Limits
    # ====================
    
    # Don't use capabilities (Docker handles this)
    use-caps-for-id: no
    
    # Limit the number of NS records in NS RRsets (CacheFlush mitigation)
    iter-scrub-ns: 20
    
    # Global query quota (CAMP mitigation - Unbound 1.21+)
    max-global-quota: 200

# ====================
# Forward Zone (Optional)
# ====================
# Uncomment below to forward queries to upstream resolvers instead of 
# doing full recursive resolution. This is useful if you want to use
# DNS-over-TLS or DNS-over-HTTPS to an upstream provider.

# forward-zone:
#     name: "."
#     forward-tls-upstream: yes
#     # Cloudflare DNS-over-TLS
#     forward-addr: 1.1.1.1@853#cloudflare-dns.com
#     forward-addr: 1.0.0.1@853#cloudflare-dns.com
#     # Google DNS-over-TLS
#     # forward-addr: 8.8.8.8@853#dns.google
#     # forward-addr: 8.8.4.4@853#dns.google
#     # Quad9 DNS-over-TLS
#     # forward-addr: 9.9.9.9@853#dns.quad9.net

# ====================
# Remote Control (Optional)
# ====================
# Enable unbound-control for runtime management

remote-control:
    control-enable: no
    # control-interface: 127.0.0.1
    # control-port: 8953
